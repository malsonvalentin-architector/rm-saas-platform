# üîß BUGFIX DEPLOYED: AttributeError –≤ Django Admin

**–î–∞—Ç–∞:** 2025-10-21  
**–ö–æ–º–º–∏—Ç:** `607cf3e`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–ø—É—à–µ–Ω –Ω–∞ GitHub ‚Üí Railway –¥–µ–ø–ª–æ–∏—Ç

---

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

**–û—à–∏–±–∫–∞:** `AttributeError: 'NoneType' object has no attribute 'name'`

**–ö–æ–Ω—Ç–µ–∫—Å—Ç:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–ª—Å—è —É–¥–∞–ª–∏—Ç—å 63 —Å—Ç–∞—Ä—ã—Ö –æ–±—ä–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ Django Admin
- –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è Django –≤—ã–∑—ã–≤–∞–ª `Obj.__str__()`
- –ú–µ—Ç–æ–¥ –ø–∞–¥–∞–ª –Ω–∞ —Å—Ç—Ä–æ–∫–µ: `return f'{self.obj} ({self.company.name})'`
- **–ü—Ä–∏—á–∏–Ω–∞:** –£ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ `self.company = None` (—Å–∏—Ä–æ—Ç—Å–∫–∏–µ –∑–∞–ø–∏—Å–∏ –±–µ–∑ –∫–æ–º–ø–∞–Ω–∏–∏)

**–§–∞–π–ª:** `data/models.py`, —Å—Ç—Ä–æ–∫–∞ 276

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ `data/models.py`:**

```python
# –ë–´–õ–û (—Å—Ç—Ä–æ–∫–∞ 276):
def __str__(self):
    return f'{self.obj} ({self.company.name})'

# –°–¢–ê–õ–û:
def __str__(self):
    company_name = self.company.name if self.company else 'No Company'
    return f'{self.obj} ({company_name})'
```

**–î–æ–±–∞–≤–ª–µ–Ω–∞ null-–ø—Ä–æ–≤–µ—Ä–∫–∞** –ø–µ—Ä–µ–¥ –æ–±—Ä–∞—â–µ–Ω–∏–µ–º –∫ `company.name`

---

## üì¶ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤ –∫–æ–º–º–∏—Ç–µ

1. **clean_demo_data.sql** (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
   - SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä—É—á–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö demo –¥–∞–Ω–Ω—ã—Ö
   - –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ FK relationships
   - –ü–æ—Ä—è–¥–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è: Data ‚Üí Atribute ‚Üí System ‚Üí Obj

2. **test_startup.sh** (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
   - –°–∫—Ä–∏–ø—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è startup –∫–æ–º–∞–Ω–¥
   - –ü–æ–º–æ–≥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –∫–æ–º–∞–Ω–¥—ã –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –®–∞–≥ 1: –î–æ–∂–¥–∞—Ç—å—Å—è Railway –¥–µ–ø–ª–æ—è (3-5 –º–∏–Ω—É—Ç)
Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç –∫–æ–º–º–∏—Ç `607cf3e` –ø–æ—Å–ª–µ push

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
1. –û—Ç–∫—Ä—ã—Ç—å https://www.promonitor.kz/admin/
2. –í–æ–π—Ç–∏ –∫–∞–∫ superadmin
3. –ü–µ—Ä–µ–π—Ç–∏ –≤ **Data ‚Üí Objs**
4. –í—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç–æ–≤ (checkbox)
5. –í dropdown –≤—ã–±—Ä–∞—Ç—å **"Delete selected objs"**
6. –ù–∞–∂–∞—Ç—å **Go**
7. **–î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è —ç–∫—Ä–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è –±–µ–∑ –æ—à–∏–±–æ–∫**

### –®–∞–≥ 3: –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ 63 –æ–±—ä–µ–∫—Ç–∞

**–í–∞—Ä–∏–∞–Ω—Ç A: Django Admin (—Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å)**
- –í—ã–¥–µ–ª–∏—Ç—å –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã ‚Üí Delete selected ‚Üí Confirm

**–í–∞—Ä–∏–∞–Ω—Ç B: SQL —Å–∫—Ä–∏–ø—Ç (–µ—Å–ª–∏ Admin –≤—Å—ë –µ—â—ë –≥–ª—é—á–∏—Ç)**
```bash
# –ß–µ—Ä–µ–∑ Railway CLI:
railway run psql $DATABASE_URL -f clean_demo_data.sql
```

### –®–∞–≥ 4: –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ demo –¥–∞–Ω–Ω—ã–µ
```bash
railway run python manage.py reset_demo_data
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- 10 –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (–æ—Ñ–∏—Å—ã, —Å–∫–ª–∞–¥—ã, –º–∞–≥–∞–∑–∏–Ω—ã)
- 3-5 —Å–∏—Å—Ç–µ–º –Ω–∞ –æ–±—ä–µ–∫—Ç (HVAC, Refrigeration, Lighting)
- 5-8 –¥–∞—Ç—á–∏–∫–æ–≤ –Ω–∞ —Å–∏—Å—Ç–µ–º—É
- 43,200+ data points (24h history, 5min intervals)

---

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:

‚úÖ Django Admin —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫  
‚úÖ –°—Ç–∞—Ä—ã–µ 63 –æ–±—ä–µ–∫—Ç–∞ —É–¥–∞–ª–µ–Ω—ã  
‚úÖ 10 –Ω–æ–≤—ã—Ö –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω—ã  
‚úÖ –í—Å–µ –æ–±—ä–µ–∫—Ç—ã –∏–º–µ—é—Ç —Å–∏—Å—Ç–µ–º—ã, –¥–∞—Ç—á–∏–∫–∏ –∏ –¥–∞–Ω–Ω—ã–µ  
‚úÖ –ì—Ä–∞—Ñ–∏–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  
‚úÖ Role-based –¥–æ—Å—Ç—É–ø —Ä–∞–±–æ—Ç–∞–µ—Ç  

---

## üìä –ö–æ–º–º–∏—Ç –¥–µ—Ç–∞–ª–∏

```bash
Commit: 607cf3e
Author: Railway auto-deploy
Date: 2025-10-21

Changed files:
- data/models.py (modified) - +2 lines, -1 line
- clean_demo_data.sql (new) - 108 lines
- test_startup.sh (new) - added

Push: cd485bc..607cf3e main -> main
```

---

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**Root cause:**
- –í –ë–î —Å—É—â–µ—Å—Ç–≤—É—é—Ç –æ–±—ä–µ–∫—Ç—ã (`Obj`) —Å `company_id = NULL`
- Django ORM –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç NULL –¥–ª—è FK –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ–∑ `blank=False, null=False`
- `__str__()` –º–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ Admin —Å–ø–∏—Å–∫–æ–≤ –∏ —Ñ–æ—Ä–º —É–¥–∞–ª–µ–Ω–∏—è
- –û–±—Ä–∞—â–µ–Ω–∏–µ –∫ –∞—Ç—Ä–∏–±—É—Ç—É `None` –æ–±—ä–µ–∫—Ç–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `AttributeError`

**–ö–∞–∫ –≤–æ–∑–Ω–∏–∫–ª–∏ NULL –∫–æ–º–ø–∞–Ω–∏–∏:**
- –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —á–µ—Ä–µ–∑ shell/–º–∏–≥—Ä–∞—Ü–∏–∏ –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è company
- –ò–ª–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–º–ø–∞–Ω–∏–∏ –±–µ–∑ ON_DELETE=CASCADE
- –ò–ª–∏ –ø—Ä–∏ direct SQL –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è—Ö

**–ü–æ—á–µ–º—É —Ä–∞–Ω—å—à–µ –Ω–µ –ø—Ä–æ—è–≤–ª—è–ª–æ—Å—å:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—ã—Ç–∞–ª—Å—è –º–∞—Å—Å–æ–≤–æ —É–¥–∞–ª—è—Ç—å –æ–±—ä–µ–∫—Ç—ã —á–µ—Ä–µ–∑ Admin
- –í –æ–±—ã—á–Ω–æ–º object_list –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è related_name='objs' —Å prefetch
- –ü—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ—è–≤–∏–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ Admin deletion view

---

**–°—Ç–∞—Ç—É—Å:** üü¢ DEPLOYED  
**Deployment time:** ~3-5 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ push  
**–¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –î–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Admin

