#!/bin/bash
# ============================================================================
# RAILWAY DEPLOYMENT COMMANDS FOR PHASE 4.4
# ============================================================================
# 
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –≤ Railway Dashboard ‚Üí Deployments ‚Üí Shell
#

echo "========================================================================"
echo "üöÄ PHASE 4.4: ACTUATORS & CONTROL - RAILWAY DEPLOYMENT"
echo "========================================================================"
echo ""

# ============================================================================
# –®–ê–ì 1: –ü–†–û–í–ï–†–ö–ê –í–ï–†–°–ò–ò DJANGO –ò PYTHON
# ============================================================================
echo "üìã –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
python --version
echo ""
python -c "import django; print(f'Django version: {django.VERSION}')"
echo ""

# ============================================================================
# –®–ê–ì 2: –ú–ò–ì–†–ê–¶–ò–Ø –ë–î
# ============================================================================
echo "========================================================================"
echo "üì¶ –®–ê–ì 2: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î..."
echo "========================================================================"
python manage.py migrate
echo ""

# ============================================================================
# –®–ê–ì 3: –ü–†–û–í–ï–†–ö–ê –ú–û–î–ï–õ–ï–ô
# ============================================================================
echo "========================================================================"
echo "üîç –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π..."
echo "========================================================================"
python manage.py shell << 'PYEOF'
from data.models import Actuator, ActuatorCommand
print(f"‚úÖ Actuator model: {Actuator._meta.db_table}")
print(f"‚úÖ ActuatorCommand model: {ActuatorCommand._meta.db_table}")
print(f"‚úÖ Actuator fields: {[f.name for f in Actuator._meta.fields]}")
PYEOF
echo ""

# ============================================================================
# –®–ê–ì 4: –°–û–ó–î–ê–ù–ò–ï –î–ï–ú–û –î–ê–ù–ù–´–•
# ============================================================================
echo "========================================================================"
echo "üéÆ –®–ê–ì 4: –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–º–æ –¥–∞–Ω–Ω—ã—Ö..."
echo "========================================================================"
python manage.py create_demo_actuators
echo ""

# ============================================================================
# –®–ê–ì 5: –°–¢–ê–¢–ò–°–¢–ò–ö–ê
# ============================================================================
echo "========================================================================"
echo "üìä –®–ê–ì 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö..."
echo "========================================================================"
python manage.py shell << 'PYEOF'
from data.models import Actuator, ActuatorCommand

actuators_count = Actuator.objects.count()
online_count = Actuator.objects.filter(is_online=True).count()
commands_count = ActuatorCommand.objects.count()
success_count = ActuatorCommand.objects.filter(status='success').count()

print(f"")
print(f"üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê:")
print(f"  –í—Å–µ–≥–æ –∞–∫—Ç—É–∞—Ç–æ—Ä–æ–≤: {actuators_count}")
print(f"  –í —Å–µ—Ç–∏: {online_count}")
print(f"  –í—Å–µ–≥–æ –∫–æ–º–∞–Ω–¥: {commands_count}")
print(f"  –£—Å–ø–µ—à–Ω—ã—Ö –∫–æ–º–∞–Ω–¥: {success_count}")
if commands_count > 0:
    print(f"  –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: {success_count/commands_count*100:.1f}%")
print(f"")
PYEOF
echo ""

# ============================================================================
# –®–ê–ì 6: –ü–†–û–í–ï–†–ö–ê URL
# ============================================================================
echo "========================================================================"
echo "üîó –®–ê–ì 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ URL routing..."
echo "========================================================================"
python manage.py shell << 'PYEOF'
from django.urls import reverse
try:
    url = reverse('data:actuators_list')
    print(f"‚úÖ Actuators list URL: {url}")
except Exception as e:
    print(f"‚ùå ERROR: {e}")
PYEOF
echo ""

# ============================================================================
# –ó–ê–í–ï–†–®–ï–ù–ò–ï
# ============================================================================
echo "========================================================================"
echo "‚úÖ –î–ï–ü–õ–û–ô –ó–ê–í–ï–†–®–Å–ù!"
echo "========================================================================"
echo ""
echo "üåê –û—Ç–∫—Ä–æ–π—Ç–µ: https://www.promonitor.kz/data/actuators/"
echo ""
echo "üìã CHECKLIST:"
echo "  [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è"
echo "  [ ] –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –¥–∞–Ω–Ω—ã–µ"
echo "  [ ] –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è"
echo "  [ ] –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç"
echo "  [ ] –ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–∞–Ω–¥ –¥–æ—Å—Ç—É–ø–Ω–∞"
echo ""
echo "üéâ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!"
echo ""
