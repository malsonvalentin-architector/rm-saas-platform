{% extends "base_generic.html" %}
{% load humanize %}

{% block title %}{{ company.name }} - Super Admin{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>üè¢ {{ company.name }}</h1>
        <div>
            <a href="{% url 'superadmin:subscription_activate' company.pk %}" class="btn btn-success">
                <i class="fas fa-credit-card"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π
            </a>
            <a href="{% url 'superadmin:company_list' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> –ö —Å–ø–∏—Å–∫—É
            </a>
        </div>
    </div>
    
    <!-- –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ -->
    <div class="alert {% if company.subscription_status == 'active' %}alert-success{% elif company.subscription_status == 'trial' %}alert-warning{% else %}alert-danger{% endif %}">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <strong>–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏:</strong> {{ company.get_subscription_status_display }}
                {% if company.days_until_expiration %}
                    <span class="ml-3">–û—Å—Ç–∞–ª–æ—Å—å: <strong>{{ company.days_until_expiration }}</strong> –¥–Ω–µ–π</span>
                {% endif %}
            </div>
            {% if not company.is_active %}
                <span class="badge badge-danger">–ö–æ–º–ø–∞–Ω–∏—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞</span>
            {% endif %}
        </div>
    </div>
    
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-white bg-primary">
                <div class="card-body">
                    <h3>{{ users.count }}</h3>
                    <p class="mb-0">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <h3>{{ objects.count }}</h3>
                    <p class="mb-0">–û–±—ä–µ–∫—Ç–æ–≤</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-info">
                <div class="card-body">
                    <h3>{{ systems.count }}</h3>
                    <p class="mb-0">–°–∏—Å—Ç–µ–º</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <h3>{{ recent_data.count }}</h3>
                    <p class="mb-0">–ó–∞–ø–∏—Å–µ–π –¥–∞–Ω–Ω—ã—Ö</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="row">
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                </div>
                <div class="card-body">
                    <table class="table table-sm">
                        <tr>
                            <th width="40%">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:</th>
                            <td>{{ company.legal_name|default:"-" }}</td>
                        </tr>
                        <tr>
                            <th>–ò–ù–ù/–ë–ò–ù:</th>
                            <td>{{ company.inn|default:"-" }}</td>
                        </tr>
                        <tr>
                            <th>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ:</th>
                            <td>{{ company.contact_person }}</td>
                        </tr>
                        <tr>
                            <th>Email:</th>
                            <td>{{ company.contact_email }}</td>
                        </tr>
                        <tr>
                            <th>–¢–µ–ª–µ—Ñ–æ–Ω:</th>
                            <td>{{ company.contact_phone|default:"-" }}</td>
                        </tr>
                        <tr>
                            <th>–ê–¥—Ä–µ—Å:</th>
                            <td>{{ company.city|default:"-" }}, {{ company.address|default:"-" }}</td>
                        </tr>
                        <tr>
                            <th>–°—Ç—Ä–∞–Ω–∞:</th>
                            <td>{{ company.country }}</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">üí∞ –ü–æ–¥–ø–∏—Å–∫–∞</h5>
                </div>
                <div class="card-body">
                    {% if subscription %}
                    <table class="table table-sm">
                        <tr>
                            <th width="40%">–¢–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω:</th>
                            <td><strong>{{ subscription.plan.name }}</strong></td>
                        </tr>
                        <tr>
                            <th>–¶–µ–Ω–∞:</th>
                            <td>${{ subscription.plan.price_monthly }}/–º–µ—Å</td>
                        </tr>
                        <tr>
                            <th>–ü–µ—Ä–∏–æ–¥:</th>
                            <td>{{ subscription.get_billing_period_display }}</td>
                        </tr>
                        <tr>
                            <th>–ù–∞—á–∞–ª–æ:</th>
                            <td>{{ subscription.start_date|date:"d.m.Y" }}</td>
                        </tr>
                        <tr>
                            <th>–û–∫–æ–Ω—á–∞–Ω–∏–µ:</th>
                            <td>{{ subscription.end_date|date:"d.m.Y" }}</td>
                        </tr>
                        <tr>
                            <th>–û–ø–ª–∞—á–µ–Ω–∞:</th>
                            <td>
                                {% if subscription.is_paid %}
                                    <span class="badge badge-success">–î–∞</span>
                                {% else %}
                                    <span class="badge badge-danger">–ù–µ—Ç</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th>–ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ:</th>
                            <td>
                                {% if subscription.auto_renew %}
                                    <span class="badge badge-success">–í–∫–ª—é—á–µ–Ω–æ</span>
                                {% else %}
                                    <span class="badge badge-secondary">–í—ã–∫–ª—é—á–µ–Ω–æ</span>
                                {% endif %}
                            </td>
                        </tr>
                    </table>
                    {% else %}
                    <p class="text-muted">–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ({{ users.count }})</h5>
        </div>
        <div class="table-responsive">
            <table class="table table-sm mb-0">
                <thead>
                    <tr>
                        <th>Email</th>
                        <th>–†–æ–ª—å</th>
                        <th>Superuser</th>
                        <th>–ê–∫—Ç–∏–≤–µ–Ω</th>
                        <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{{ user.email }}</td>
                        <td>
                            {% if user.role == 'company_admin' %}
                                <span class="badge badge-success">{{ user.get_role_display }}</span>
                            {% elif user.role == 'operator' %}
                                <span class="badge badge-info">{{ user.get_role_display }}</span>
                            {% else %}
                                <span class="badge badge-warning">{{ user.get_role_display }}</span>
                            {% endif %}
                        </td>
                        <td>{% if user.is_superuser %}‚úÖ{% else %}‚ùå{% endif %}</td>
                        <td>{% if user.is_active %}‚úÖ{% else %}‚ùå{% endif %}</td>
                        <td>{{ user.date_joined|date:"d.m.Y" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center text-muted">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- –û–±—ä–µ–∫—Ç—ã –∏ —Å–∏—Å—Ç–µ–º—ã -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">üèóÔ∏è –û–±—ä–µ–∫—Ç—ã –∏ —Å–∏—Å—Ç–µ–º—ã ({{ objects.count }})</h5>
        </div>
        <div class="table-responsive">
            <table class="table table-sm mb-0">
                <thead>
                    <tr>
                        <th>–û–±—ä–µ–∫—Ç</th>
                        <th>–ì–æ—Ä–æ–¥</th>
                        <th>–°–∏—Å—Ç–µ–º</th>
                        <th>–ê–∫—Ç–∏–≤–µ–Ω</th>
                        <th>–°–æ–∑–¥–∞–Ω</th>
                    </tr>
                </thead>
                <tbody>
                    {% for obj in objects %}
                    <tr>
                        <td><strong>{{ obj.obj }}</strong></td>
                        <td>{{ obj.city|default:"-" }}</td>
                        <td>{{ obj.system_set.count }}</td>
                        <td>{% if obj.is_active %}‚úÖ{% else %}‚ùå{% endif %}</td>
                        <td>{{ obj.created_at|date:"d.m.Y" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center text-muted">–ù–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- –°—á–µ—Ç–∞ -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">üìÑ –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å—á–µ—Ç–∞</h5>
        </div>
        <div class="table-responsive">
            <table class="table table-sm mb-0">
                <thead>
                    <tr>
                        <th>–ù–æ–º–µ—Ä</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã</th>
                        <th>–°–æ–∑–¥–∞–Ω</th>
                    </tr>
                </thead>
                <tbody>
                    {% for invoice in invoices %}
                    <tr>
                        <td>{{ invoice.invoice_number }}</td>
                        <td>${{ invoice.amount }}</td>
                        <td>
                            {% if invoice.status == 'paid' %}
                                <span class="badge badge-success">–û–ø–ª–∞—á–µ–Ω</span>
                            {% elif invoice.status == 'pending' %}
                                <span class="badge badge-warning">–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã</span>
                            {% else %}
                                <span class="badge badge-secondary">{{ invoice.get_status_display }}</span>
                            {% endif %}
                        </td>
                        <td>{{ invoice.due_date|date:"d.m.Y" }}</td>
                        <td>{{ invoice.created_at|date:"d.m.Y" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center text-muted">–ù–µ—Ç —Å—á–µ—Ç–æ–≤</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
