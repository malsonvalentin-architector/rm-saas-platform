{% extends 'dashboard_v2/base_full.html' %}
{% load static %}

{% block title %}Control Panel - Floor Plans{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Control Panel</h1>
    <p class="page-subtitle">–•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º</p>
</div>

<!-- CONTROL SCHEMA -->
<div class="control-schema">
    <div class="schema-header">
        <h2 class="schema-title">üó∫Ô∏è –°—Ö–µ–º–∞ –æ–±—ä–µ–∫—Ç–∞ - –ì–ª–∞–≤–Ω–æ–µ –∑–¥–∞–Ω–∏–µ</h2>
        <div class="schema-controls">
            <button class="schema-btn">üîç Zoom In</button>
            <button class="schema-btn">üîç Zoom Out</button>
            <button class="schema-btn">üîÑ Reset</button>
        </div>
    </div>

    <div class="schema-canvas" id="schemaCanvas">
        <!-- HVAC UNITS -->
        <div class="equipment-node" style="top: 50px; left: 100px;" onclick="openEquipmentDrawer('hvac-zone1')">
            <div class="hvac-unit">
                <div class="node-status status-online"></div>
            </div>
            <div class="node-label">HVAC Zone 1</div>
            <div class="node-value">22.5¬∞C</div>
        </div>

        <div class="equipment-node" style="top: 50px; left: 300px;" onclick="openEquipmentDrawer('hvac-zone2')">
            <div class="hvac-unit">
                <div class="node-status status-warning"></div>
            </div>
            <div class="node-label">HVAC Zone 2</div>
            <div class="node-value">25.8¬∞C ‚ö†Ô∏è</div>
        </div>

        <!-- SENSOR UNITS -->
        <div class="equipment-node" style="top: 180px; left: 200px;" onclick="openEquipmentDrawer('sensor-1')">
            <div class="sensor-unit">
                <div class="node-status status-online"></div>
            </div>
            <div class="node-label">Sensor #1</div>
            <div class="node-value">Normal</div>
        </div>

        <div class="equipment-node" style="top: 320px; left: 350px;" onclick="openEquipmentDrawer('sensor-2')">
            <div class="sensor-unit">
                <div class="node-status status-online"></div>
            </div>
            <div class="node-label">Sensor #2</div>
            <div class="node-value">Normal</div>
        </div>

        <!-- FAN UNIT -->
        <div class="equipment-node" style="top: 180px; left: 450px;" onclick="openEquipmentDrawer('fan-12')">
            <div class="fan-unit">
                <div class="node-status status-online"></div>
            </div>
            <div class="node-label">Fan #12</div>
            <div class="node-value">1450 RPM</div>
        </div>

        <!-- BOILER UNIT -->
        <div class="equipment-node" style="top: 320px; left: 100px;" onclick="openEquipmentDrawer('boiler-1')">
            <div class="boiler-unit">
                <div class="node-status status-online"></div>
            </div>
            <div class="node-label">Boiler #1</div>
            <div class="node-value">75¬∞C</div>
        </div>

        <!-- PUMP UNIT -->
        <div class="equipment-node" style="top: 50px; left: 550px;" onclick="openEquipmentDrawer('pump-1')">
            <div class="pump-unit">
                <div class="node-status status-online"></div>
            </div>
            <div class="node-label">Pump #1</div>
            <div class="node-value">Active</div>
        </div>

        <!-- CHILLER UNIT -->
        <div class="equipment-node" style="top: 320px; left: 550px;" onclick="openEquipmentDrawer('chiller-1')">
            <div class="chiller-unit">
                <div class="node-status status-online"></div>
            </div>
            <div class="node-label">Chiller #1</div>
            <div class="node-value">7.2¬∞C</div>
        </div>

        <!-- CONTROLLER UNIT -->
        <div class="equipment-node" style="top: 180px; left: 650px;" onclick="openEquipmentDrawer('controller-main')">
            <div class="controller-unit">
                <div class="node-status status-online"></div>
            </div>
            <div class="node-label">Main PLC</div>
            <div class="node-value">Online</div>
        </div>

        <!-- CONNECTION PIPES -->
        <!-- Horizontal: HVAC Zone 1 (100px) to HVAC Zone 2 (300px) -->
        <div class="connection-pipe" style="top: 85px; left: 165px; width: 130px;"></div>
        
        <!-- Horizontal: Sensor #1 (200px) to Fan #12 (450px) -->
        <div class="connection-pipe" style="top: 215px; left: 265px; width: 180px;"></div>
        
        <!-- Horizontal: Boiler (100px) to Sensor #2 (350px) -->
        <div class="connection-pipe" style="top: 355px; left: 165px; width: 180px;"></div>
        
        <!-- Vertical: HVAC Zone 2 (300px, 50px) to Sensor #1 (200px, 180px) -->
        <div class="connection-pipe" style="top: 115px; left: 265px; width: 4px; height: 60px;"></div>
        
        <!-- Vertical: Fan #12 (450px, 180px) to Sensor #2 (350px, 320px) -->
        <div class="connection-pipe" style="top: 245px; left: 415px; width: 4px; height: 70px;"></div>
    </div>
</div>

<!-- INFO CARDS -->
<div class="page-header" style="margin-top: 40px;">
    <h2 style="font-size: 20px; font-weight: 600;">–ê–∫—Ç–∏–≤–Ω—ã–µ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h2>
</div>

<div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
    <div class="metric-card">
        <div class="card-icon">‚ùÑÔ∏è</div>
        <div class="card-title">HVAC –°–∏—Å—Ç–µ–º—ã</div>
        <div class="card-value" style="font-size: 22px;">4</div>
        <div class="card-detail">–í—Å–µ–≥–æ –µ–¥–∏–Ω–∏—Ü</div>
    </div>

    <div class="metric-card">
        <div class="card-icon">üå°Ô∏è</div>
        <div class="card-title">–î–∞—Ç—á–∏–∫–∏</div>
        <div class="card-value" style="font-size: 22px;">12</div>
        <div class="card-detail">–ê–∫—Ç–∏–≤–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏</div>
    </div>

    <div class="metric-card">
        <div class="card-icon">üí®</div>
        <div class="card-title">–í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä—ã</div>
        <div class="card-value" style="font-size: 22px;">3</div>
        <div class="card-detail">–†–∞–±–æ—Ç–∞—é—Ç</div>
    </div>

    <div class="metric-card">
        <div class="card-icon">üî•</div>
        <div class="card-title">–ö–æ—Ç–ª—ã</div>
        <div class="card-value" style="font-size: 22px;">2</div>
        <div class="card-detail">–í —Ä–∞–±–æ—á–µ–º —Ä–µ–∂–∏–º–µ</div>
    </div>

    <div class="metric-card">
        <div class="card-icon">üíß</div>
        <div class="card-title">–ù–∞—Å–æ—Å—ã</div>
        <div class="card-value" style="font-size: 22px;">6</div>
        <div class="card-detail">5 –∞–∫—Ç–∏–≤–Ω—ã</div>
    </div>

    <div class="metric-card">
        <div class="card-icon">üßä</div>
        <div class="card-title">–ß–∏–ª–ª–µ—Ä—ã</div>
        <div class="card-value" style="font-size: 22px;">1</div>
        <div class="card-detail">–†–∞–±–æ—Ç–∞–µ—Ç</div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Enhanced openEquipmentDrawer with mock data for Phase 2
    window.openEquipmentDrawer = function(equipmentId) {
        const drawer = document.getElementById('drawer');
        const overlay = document.getElementById('overlay');
        const drawerTitle = document.getElementById('drawerTitle');
        const drawerContent = document.getElementById('drawerContent');

        // Mock equipment data (will be replaced with API calls)
        const equipmentData = {
            'hvac-zone1': {
                title: '‚ùÑÔ∏è HVAC Zone 1 - Cooling System',
                html: `
                    <div class="detail-section">
                        <h3 class="detail-section-title">–ü–ê–†–ê–ú–ï–¢–†–´ –†–ê–ë–û–¢–´</h3>
                        <div class="detail-item">
                            <span class="detail-label">–°—Ç–∞—Ç—É—Å</span>
                            <span class="detail-value" style="color: var(--success)">üü¢ Online</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</span>
                            <span class="detail-value">22.5¬∞C</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–¶–µ–ª–µ–≤–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</span>
                            <span class="detail-value">22.0¬∞C</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–†–µ–∂–∏–º</span>
                            <span class="detail-value">–û—Ö–ª–∞–∂–¥–µ–Ω–∏–µ</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–ú–æ—â–Ω–æ—Å—Ç—å</span>
                            <span class="detail-value">75%</span>
                        </div>
                    </div>

                    <div class="control-panel">
                        <h3 style="margin-bottom: 20px; font-size: 16px;">üéõÔ∏è –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø</h3>
                        
                        <div class="control-row">
                            <span class="control-label">–í–∫–ª/–í—ã–∫–ª</span>
                            <div class="control-input">
                                <div class="toggle-switch active" onclick="this.classList.toggle('active')"></div>
                            </div>
                        </div>

                        <div class="control-row">
                            <span class="control-label">–¶–µ–ª–µ–≤–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</span>
                            <div class="control-input">
                                <input type="number" class="number-input" value="22" step="0.5" min="18" max="30">
                                <span style="font-size: 12px; color: var(--text-secondary);">¬∞C</span>
                            </div>
                        </div>

                        <button class="control-btn" onclick="sendCommand('${equipmentId}', 'update')">
                            üíæ –ü–†–ò–ú–ï–ù–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø
                        </button>
                    </div>
                `
            },
            'hvac-zone2': {
                title: '‚ùÑÔ∏è HVAC Zone 2 - Cooling System (‚ö†Ô∏è Warning)',
                html: `
                    <div class="detail-section">
                        <h3 class="detail-section-title">–ü–ê–†–ê–ú–ï–¢–†–´ –†–ê–ë–û–¢–´</h3>
                        <div class="detail-item">
                            <span class="detail-label">–°—Ç–∞—Ç—É—Å</span>
                            <span class="detail-value" style="color: var(--warning)">üü° Warning</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–ü—Ä–æ–±–ª–µ–º–∞</span>
                            <span class="detail-value" style="color: var(--warning)">–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–¢–µ–∫—É—â–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</span>
                            <span class="detail-value" style="color: var(--warning)">25.8¬∞C ‚ö†Ô∏è</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–¶–µ–ª–µ–≤–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</span>
                            <span class="detail-value">22.0¬∞C</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–ú–æ—â–Ω–æ—Å—Ç—å</span>
                            <span class="detail-value">98% (!)</span>
                        </div>
                    </div>

                    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid var(--warning); border-radius: 12px; padding: 16px; margin-bottom: 20px;">
                        <div style="font-weight: 600; margin-bottom: 8px; color: var(--warning);">‚ö†Ô∏è –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:</div>
                        <div style="font-size: 13px; color: var(--text-secondary);">
                            ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–∏<br>
                            ‚Ä¢ –£–≤–µ–ª–∏—á–∏—Ç—å –º–æ—â–Ω–æ—Å—Ç—å –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è<br>
                            ‚Ä¢ –í–æ–∑–º–æ–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –≤ –∑–æ–Ω–µ
                        </div>
                    </div>

                    <div class="control-panel">
                        <h3 style="margin-bottom: 20px; font-size: 16px;">üéõÔ∏è –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø</h3>
                        
                        <div class="control-row">
                            <span class="control-label">–§–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏–µ</span>
                            <div class="control-input">
                                <div class="toggle-switch" onclick="this.classList.toggle('active')"></div>
                            </div>
                        </div>

                        <button class="control-btn" onclick="sendCommand('${equipmentId}', 'boost_cooling')">
                            üíæ –ü–†–ò–ú–ï–ù–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø
                        </button>
                    </div>
                `
            },
            'fan-12': {
                title: 'üí® Ventilation Fan Unit 12',
                html: `
                    <div class="detail-section">
                        <h3 class="detail-section-title">–ü–ê–†–ê–ú–ï–¢–†–´ –†–ê–ë–û–¢–´</h3>
                        <div class="detail-item">
                            <span class="detail-label">–°–∫–æ—Ä–æ—Å—Ç—å –≤—Ä–∞—â–µ–Ω–∏—è</span>
                            <span class="detail-value">1450 RPM</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–≠–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ</span>
                            <span class="detail-value">450 –í—Ç</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–†–∞—Å—Ö–æ–¥ –≤–æ–∑–¥—É—Ö–∞</span>
                            <span class="detail-value">1200 –º¬≥/—á</span>
                        </div>
                    </div>

                    <div class="control-panel">
                        <h3 style="margin-bottom: 20px; font-size: 16px;">üéõÔ∏è –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø</h3>
                        
                        <div class="control-row">
                            <span class="control-label">–í–∫–ª/–í—ã–∫–ª</span>
                            <div class="control-input">
                                <div class="toggle-switch active" onclick="this.classList.toggle('active')"></div>
                            </div>
                        </div>

                        <button class="control-btn" onclick="sendCommand('${equipmentId}', 'toggle')">
                            üíæ –ü–†–ò–ú–ï–ù–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø
                        </button>
                    </div>
                `
            },
            'boiler-1': {
                title: 'üî• Boiler #1 - –ö–æ—Ç–µ–ª—å–Ω–∞—è',
                html: `
                    <div class="detail-section">
                        <h3 class="detail-section-title">–ü–ê–†–ê–ú–ï–¢–†–´ –†–ê–ë–û–¢–´</h3>
                        <div class="detail-item">
                            <span class="detail-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–¥—ã</span>
                            <span class="detail-value">75¬∞C</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–î–∞–≤–ª–µ–Ω–∏–µ</span>
                            <span class="detail-value">2.1 –±–∞—Ä</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–ú–æ—â–Ω–æ—Å—Ç—å –≥–æ—Ä–µ–ª–∫–∏</span>
                            <span class="detail-value">62%</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–†–∞—Å—Ö–æ–¥ –≥–∞–∑–∞</span>
                            <span class="detail-value">3.2 –º¬≥/—á</span>
                        </div>
                    </div>

                    <div class="control-panel">
                        <h3 style="margin-bottom: 20px; font-size: 16px;">üéõÔ∏è –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø</h3>
                        
                        <div class="control-row">
                            <span class="control-label">–¶–µ–ª–µ–≤–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</span>
                            <div class="control-input">
                                <input type="number" class="number-input" value="75" step="5" min="40" max="90">
                                <span style="font-size: 12px; color: var(--text-secondary);">¬∞C</span>
                            </div>
                        </div>

                        <button class="control-btn" onclick="sendCommand('${equipmentId}', 'set_temperature')">
                            üíæ –ü–†–ò–ú–ï–ù–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø
                        </button>
                    </div>
                `
            }
        };

        const data = equipmentData[equipmentId] || {
            title: 'Equipment Details',
            html: '<p style="text-align:center;padding:40px;">‚öôÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>'
        };

        drawerTitle.textContent = data.title;
        drawerContent.innerHTML = data.html;

        drawer.classList.add('open');
        overlay.classList.add('active');
    };
</script>
{% endblock %}
